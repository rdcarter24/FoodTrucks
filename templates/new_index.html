<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
    </style>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyB-aXzmKl3zsyKUYJYwFzkQWjU0-hlVklk&sensor=false"></script>
    <script>
        function getLocation(){
            if (navigator.geolocation){
                navigator.geolocation.getCurrentPosition(initialize);
            }
            else{x.innerHTML="Geolocation is not supported by this browser.";}
            }
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        function initialize(position) {
            document.getElementById("userLat").value=position.coords.latitude;
            document.getElementById("userLng").value=position.coords.longitude;
            //document.getElementById('input').submit();
            directionsDisplay = new google.maps.DirectionsRenderer();
            var userLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            console.log("test" + userLatLng)
            var mapOptions = {
                center: userLatLng,
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);
            user = new google.maps.Marker({map: map, position: userLatLng,title: "user" });//can add a title to Marker
            directionsDisplay.setMap(map);



            google.maps.event.addListener(user, 'click', function() {
                calcRoute(userLatLng);
            });

            }

        function calcRoute(userLatLng) {
            // var start = document.getElementById("start").value;
            // var end = document.getElementById("end").value;
            var request = {
                origin:userLatLng,
                destination:"500 Harrison San Francisco, CA",//new google.maps.LatLng(latitude, longitude),
                travelMode: google.maps.TravelMode.DRIVING
            };
            directionsService.route(request, function(result, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(result);
            }
          });
        }
        getLocation()


    </script>
  </head>
<body>

    <div id="map-canvas" style="float:left;width:70%; height:100%"></div>
    <form id="input" action="/input">
        <input type="hidden" Id="userLat" name="latitude"  value=""/>
        <input type="hidden" Id="userLng" name="longitude"  value=""/>
    </form>
</body>